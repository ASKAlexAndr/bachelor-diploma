\section{Анализ алгоритмов} \label{Dev}

\subsection{Постановка задачи}
COVID-19 - тяжелая респираторная инфекция, вызываемая коронавирусом SARS-CoV-2. На момент написания работы, вспышка вируса, возникщая в китайском городе Ухань, переросла в глобальную пандемию. Основным способом диагностики COVID-19 является метод полимеразной цепной реакции (ПЦР) с обратной транскрипцией, однако это трудоемкий, требующий участия человека процесс. Альтернативой является рентгенологической исследование, например рентген грудной клетки или компьютерная томография (КТ). Исследования показывают, что большинство снимков пациентов с COVID-19 содержат спецефические аномалии, такие как двустороннее ретикулярное узловое затемнение или синдром матового стекла, что позволяет визуально отличить заболевание от других видов пневмоний \cite{wang2020covidnet}. Несмотря на то, что рентген обладает меньшей чуствительностью чем КТ или ПЦР, это гораздо более доступный и быстрый метод диагностики, что является существенным критерием в период пандемии. Решение задачи автоматической диагностики данного заболевания позвол.ит снизить нагрузку на врачей и повысит эффективность их работы.

\addthreeimghere{xray-normal}{Норма}{xray-pneumonia}{Пневмония}{xray-covid}{COVID-19}{Рентгеновские снимки грудных клеток}{xrays}

\subsection{Средства реализации}
cuDNN - библиотека глубоких нейронных сетей от Nvidia позволяющая использовать для вычеслений мощности графического процессора.

Python 3 - гибкий и мощный язык программирования, эффективно выполняющий задачи анализа и обработки данных.

TensorFlow - многофункциональный фреймворк с открытым исходным кодом, разработанный компанией Google, позволяющий проектировать и обучать различные архитектуры нейронных сетей.

Keras - высокоуровневый API для решения задач глубокого машинного обучения, входящий в состав TensorFlow.

% \subsection{Конфигурация системы}
% Все модели были протестированы на системе со следующими характеристиками:
% \begin{itemize}
%   \item Операционная система - Ubuntu 20.04
%   \item Процессор - Intel Core i5 9400F CPU 2.90 Ghz
%   \item Объем оперативной памяти - 8 Гб
%   \item Видеокарта - Nvidia GeForce GTX 1660
% \end{itemize}

\subsection{Оценка качества}
Для оценки качества работы алгоритмов использовались следующие метрики:
\begin{itemize}
    \item Precision: \[P = \frac{TP}{TP+FP}\]
    \item Recall: \[R=\frac{TP}{TP+FN}\] 
\end{itemize}
где TP - количество истинно-положительных FP - ложно-положительных, FN - ложно-негативных ответов.

Также в процессе обучения сети в качестве характеристики качества обучения рассматривались значения функции потерь.

\subsection{Обучающая выборка}
Сбор данных для обучения нейронных сетей в задачах такого типа - сложный и долгий процесс, который требует затрат большого количества времени и участие большого количества людей. Поэтому, в качестве источника обучающих и проверочных данных использовались готовые, уже размеченные датасеты: \cite{tawsifurrahman}, \cite{cohen2020covid} и \cite{wang2020covidnet}. 
Всего было собрано 14 197 cнимков, из них 8 066 здоровых пациентов, 5 558 с пневмонией и 573 с COVID-19. По 100 изображений каждого класса было отобрано для валидации обучения.

% Общее количество снимков указано в таблице \ref{inputs}

% \input{thesis/extra/inputs.tex}

% Снимки из обучающей выборки имеют разное разрешение, однако нейронные сети требуют заранее установленное количество входных нейронов. Поэтому, в качестве предварительной обработки данных, все изображения перед подачей на сеть маштабируются к одному разрешению: 512x512 px.


\subsection{Эксперименты}
При использовании глубоких нейронных сетей в задачах классификации изображений требуется проведение дополнительных исследований, с целью выбора оптимальных параметров различных частей алгоритмов. 

\subsubsection{Предварительная обработка изображений}
Предварительная обработка входных данных может существенно повлиять на обучение моделей. В рамках данной части исследования рассматривались следующие варианты обработки изображений:
\begin{itemize}    
    \item Масштабирование - деление всех значений в изображение на 255.
    \item Центрирование среднего значения в 0 и нормализация среднеквадратичного отклонения в 1.
\end{itemize}
В исследовании были протестированы следующие модели нейронных сетей со стандартными параметрами:
\begin{itemize}
    \item Inception V3, размерность входного слоя: 299x299
    \item ResNet-50, размерность входного слоя: 224x224
    \item DenseNet-201, размерность входного слоя:  224x224
\end{itemize} 
Обучение всех моделей проходило по 10 эпох, размер одного пакета - 16 изображений. В качестве функции потерь использовалась категориальная перекрестная энтропия, в качестве оптимизатора - Адам. Обучение останавливалось заранее, если значение функции loss на валидационной выборке не уменьшалось в течение пяти эпох. Значения функции ошибки (loss), метрик precision и recall  по итогам обучения и валидации (приставка «val\_») для обработанных изображений методоми маштабирования и центрирования указаны в таблицах \ref{rescale} и \ref{samplewise} соответственно. 

\input{thesis/extra/image_preprocessing}

Результаты показывают, что предпочтительно для данной задачи выбрать * обработку изображений.  

\subsubsection{Выбор оптимизатора}




% В ходе экспериментов были модернизированы для задачи, обучены и протестированы  модели на базе следующих архитектур: Inception, ResNet и DenseNet. 
% Точность сетей по метрике accuracy в процессе обучения и тестирования показана на рис. \ref{train-results}. Финальные результаты экспериментов указаны в таблице \ref{test-results}

% \addtwoimghere{train_accuracy}{Обучение}{val_accuracy}{Тестирование}{Точность сетей}{train-results}


% \input{thesis/extra/test-results.tex}

\clearpage